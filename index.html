<?php
// ১. ডাটাবেজ কানেকশন (একই ফাইলে)
$conn = new mysqli("localhost", "root", "", "btmob_db");

if ($conn->connect_error) {
    die("Database Connection Failed!");
}

session_start();
$message = "";

// ২. রেজিস্ট্রেশন এবং লগইন লজিক
if(isset($_POST['action'])) {
    $email = $_POST['email'];
    $pass = $_POST['password'];

    if($_POST['action'] == "register") {
        $hashed_pass = password_hash($pass, PASSWORD_DEFAULT);
        $check = $conn->query("SELECT * FROM users WHERE gmail='$email'");
        if($check->num_rows > 0) {
            $message = "<span style='color:red;'>Email already exists!</span>";
        } else {
            $conn->query("INSERT INTO users (gmail, password) VALUES ('$email', '$hashed_pass')");
            $message = "<span style='color:green;'>Account Created! Please Login.</span>";
        }
    } 
    
    if($_POST['action'] == "login") {
        $result = $conn->query("SELECT * FROM users WHERE gmail='$email'");
        if($row = $result->fetch_assoc()) {
            if(password_verify($pass, $row['password'])) {
                $_SESSION['user'] = $email;
                $message = "<span style='color:cyan;'>Login Successful! Redirecting...</span>";
                header("refresh:2;url=#dashboard"); // ড্যাশবোর্ড সেকশনে নিয়ে যাবে
            } else { $message = "<span style='color:red;'>Wrong Password!</span>"; }
        } else { $message = "<span style='color:red;'>No User Found!</span>"; }
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>BTMOB 4.0.1 - Control Panel</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0d0d0d; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: #1a1a1a; padding: 40px; border-radius: 15px; border: 1px solid #ff0055; box-shadow: 0 0 20px #ff005544; width: 350px; text-align: center; }
        h2 { color: #ff0055; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #222; color: #fff; box-sizing: border-box; }
        .btn-login { width: 100%; padding: 12px; background: #ff0055; border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 8px; margin-top: 10px; }
        .btn-reg { width: 100%; padding: 12px; background: transparent; border: 1px solid #ff0055; color: #ff0055; font-weight: bold; cursor: pointer; border-radius: 8px; margin-top: 10px; }
        .dashboard { display: <?php echo isset($_SESSION['user']) ? 'block' : 'none'; ?>; background: #1a1a1a; padding: 50px; border-radius: 15px; text-align: center; border: 2px solid #00ff88; }
        .login-form { display: <?php echo isset($_SESSION['user']) ? 'none' : 'block'; ?>; }
    </style>
</head>
<body>

    <div class="box login-form">
        <h2>BTMOB OFFICIAL</h2>
        <p><?php echo $message; ?></p>
        <form method="post">
            <input type="email" name="email" placeholder="Gmail Address" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit" name="action" value="login" class="btn-login">LOGIN</button>
            <button type="submit" name="action" value="register" class="btn-reg">CREATE ACCOUNT</button>
        </form>
    </div>

    <div class="dashboard" id="dashboard">
        <h1 style="color: #00ff88;">ACCESS GRANTED</h1>
        <p>Welcome, <b><?php echo $_SESSION['user']; ?></b></p>
        <p>Your BTMOB 4.0.1 Trial is now <b>Active</b>.</p>
        <a href="?logout=1" style="color: #ff0055; text-decoration: none;">Logout</a>
    </div>

    <?php 
    if(isset($_GET['logout'])) { session_destroy(); header("Location: index.php"); } 
    ?>

</body>
</html>
